var A=Object.defineProperty;var S=(t,e,s)=>e in t?A(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s;var w=(t,e,s)=>(S(t,typeof e!="symbol"?e+"":e,s),s),z=(t,e,s)=>{if(!e.has(t))throw TypeError("Cannot "+s)};var b=(t,e,s)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,s)};var k=(t,e,s)=>(z(t,e,"access private method"),s);import{H as B,o as l,$ as h,w as c,a as v,R as o,c as d,t as y,r as M,ai as D,b as u,S as H,d as V,a4 as L,Z as q,_ as E,U as T,F as N,a0 as I}from"./entry.PBEUk6LD.js";import{_ as C}from"./user-default.M6WcreL7.js";import{m as $}from"./messengerRepository.9vw58vSR.js";import{N as R}from"./Image.FRWC7sct.js";import{N as p}from"./Space.rf2RjuyU.js";import{a as Z,N as G,b as J}from"./FormItem.VgEUpILy.js";import{u as K}from"./use-message.SxD0MRC_.js";import"./utils.-mEM30r4.js";import"./Tooltip.tF9kFX5E.js";import"./Popover.wPaNbpv5.js";import"./use-locale.cCovaJlO.js";import"./format-length.4l65r8M5.js";import"./use-merged-state.c9_Klzw1.js";import"./get-slot.bpfTnPl7.js";var x,j,g,F;class O{constructor(e){b(this,x);b(this,g);w(this,"receiverUser",null);w(this,"senderUser",null);w(this,"messages",[]);console.log(e),this.receiverUser=k(this,x,j).call(this,e==null?void 0:e.receiver_user)??null,this.senderUser=k(this,x,j).call(this,e==null?void 0:e.sender_user)??null,this.messages=k(this,g,F).call(this,(e==null?void 0:e.sent_messages)??[])}}x=new WeakSet,j=function(e){return{id:(e==null?void 0:e.id)??null,name:(e==null?void 0:e.name)??"",avatar:(e==null?void 0:e.avatar)??null}},g=new WeakSet,F=function(e){return e.map(s=>({id:s.id,senderId:(s==null?void 0:s.sender_id)??null,receiverId:(s==null?void 0:s.receiver_id)??null,content:(s==null?void 0:s.content)??null,createdAt:(s==null?void 0:s.created_at)??null,updatedAt:(s==null?void 0:s.updated_at)??null}))};const P={class:"h-[250px] w-[250px] relative overflow-hidden rounded-md"},Q={key:1,src:C,class:"w-full h-full object-cover"},W={class:"space-y-1"},X={class:"text-xl md:text-3xl font-medium leading-none"},Y=B({__name:"MessengerHeader",props:{user:{}},setup(t){return console.log(t.user),(s,r)=>(l(),h(o(p),{size:"large"},{default:c(()=>{var _,m,n;return[v("div",P,[(_=s.user)!=null&&_.avatar?(l(),h(o(R),{key:0,src:(m=s.user)==null?void 0:m.avatar,"fallback-src":"~/assets/images/profile/user-default.png",width:"100%",height:"100%","object-fit":"cover",class:"w-full h-full"},null,8,["src"])):(l(),d("img",Q))]),v("div",W,[v("h3",X,y((n=s.user)==null?void 0:n.name),1)])]}),_:1}))}}),ee=B({__name:"MessngerForm",emits:["validated","rejected"],setup(t,{emit:e}){const s={textarea:{required:!0,trigger:["blur","input"],message:"Поле не должно быть пустым"}},r=M({textarea:""}),_=M(null),m=e,n=i=>{var f;i.preventDefault(),(f=_.value)==null||f.validate(a=>{a?m("rejected"):(m("validated",r.value.textarea),r.value.textarea="")})};return(i,f)=>{const a=D("n-space");return l(),h(o(J),{ref_key:"formRef",ref:_,model:r.value,rules:s},{default:c(()=>[u(o(G),{span:12,path:"textarea"},{default:c(()=>[u(o(Z),{value:r.value.textarea,"onUpdate:value":f[0]||(f[0]=U=>r.value.textarea=U),type:"textarea",autosize:{minRows:3,maxRows:5},placeholder:"Введите ваше сообщение",round:"",clearable:""},null,8,["value"])]),_:1}),u(a,null,{default:c(()=>[u(o(H),{round:"",type:"primary",onClick:n},{default:c(()=>[V(" Отправить ")]),_:1})]),_:1})]),_:1},8,["model"])}}}),se={class:"mt-4"},re=v("div",{class:"text-xl mb-3"},"Сообщение",-1),te={class:"mt-6"},le=v("div",{class:"text-xl mb-3"},"Переписка",-1),oe={class:"h-[65px] relative overflow-hidden rounded-md"},ne={key:1,src:C,class:"w-full h-full object-cover"},ae={key:1,src:C,class:"w-full h-full object-cover"},ce={key:0},ue={key:1},Ne=B({__name:"[id]",setup(t){const e=L(),s=K();q();const r=M(null),_=async()=>{try{const n=await $.getMessagesById(e.params.id);console.log("Response messenger: ",n),r.value=new O(n.messages)??null,console.log("mess: ",r.value)}catch(n){console.log(n)}},m=async n=>{try{console.log("data from form: ",n);const i=await $.sendMessageById({receiver_id:e.params.id,content:n??""});s.success(i),await _()}catch(i){console.log("error: to send message: ",i)}};return E(async()=>{await _()}),(n,i)=>(l(),h(o(p),{vertical:""},{default:c(()=>{var f;return[u(Y,{user:(f=r.value)==null?void 0:f.receiverUser},null,8,["user"]),v("div",se,[u(o(p),{vertical:""},{default:c(()=>[re,u(ee,{onValidated:i[0]||(i[0]=a=>m(a))})]),_:1})]),v("div",te,[le,r.value&&r.value.messages.length?(l(),h(o(p),{key:0,vertical:""},{default:c(()=>[(l(!0),d(N,null,T(r.value.messages,(a,U)=>(l(),d("div",{key:U,class:"chat"},[u(o(p),null,{default:c(()=>[u(o(p),null,{default:c(()=>[v("div",oe,[a.senderId===r.value.senderUser.id?(l(),d(N,{key:0},[r.value.senderUser.avatar?(l(),h(o(R),{key:0,src:r.value.senderUser.avatar,"fallback-src":"~/assets/images/profile/user-default.png",width:"100%",height:"100%","object-fit":"cover",class:"w-full h-full"},null,8,["src"])):(l(),d("img",ne))],64)):a.senderId===r.value.receiverUser.id?(l(),d(N,{key:1},[r.value.receiverUser.avatar?(l(),h(o(R),{key:0,src:r.value.receiverUser.avatar,"fallback-src":"~/assets/images/profile/user-default.png",width:"100%",height:"100%","object-fit":"cover",class:"w-full h-full"},null,8,["src"])):(l(),d("img",ae))],64)):I("",!0)])]),_:2},1024),u(o(p),{vertical:"",justify:"space-between"},{default:c(()=>[u(o(p),{class:"font-medium"},{default:c(()=>[a.senderId===r.value.senderUser.id?(l(),d("div",ce,y(r.value.senderUser.name),1)):a.senderId===r.value.receiverUser.id?(l(),d("div",ue,y(r.value.receiverUser.name),1)):I("",!0),v("div",null,y(a.createdAt),1)]),_:2},1024),V(" "+y(a.content),1)]),_:2},1024)]),_:2},1024)]))),128))]),_:1})):I("",!0)])]}),_:1}))}});export{Ne as default};
