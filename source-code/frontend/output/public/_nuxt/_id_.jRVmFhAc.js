var A=Object.defineProperty;var z=(t,e,s)=>e in t?A(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s;var k=(t,e,s)=>(z(t,typeof e!="symbol"?e+"":e,s),s),D=(t,e,s)=>{if(!e.has(t))throw TypeError("Cannot "+s)};var U=(t,e,s)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,s)};var w=(t,e,s)=>(D(t,e,"access private method"),s);import{H as M,o,a1 as m,w as a,a as _,c as d,t as x,U as l,r as I,ad as H,b as c,Y as L,d as C,ae as S,$ as q,a6 as E,V as P,F as b,a2 as N}from"./entry.1ZxYl7KD.js";import{_ as j}from"./user-default.5qadS4Gj.js";import{m as V}from"./messengerRepository.6LEBABU9.js";import{N as f}from"./Space.oLpKv7Xc.js";import{a as T,N as Y,b as G}from"./FormItem.XVjOkwkx.js";import{u as J}from"./use-message.S9nCrm0E.js";import{N as $}from"./Image.b2j99VNW.js";import"./get-slot.bpfTnPl7.js";import"./Popover.P0RjMtAw.js";import"./format-length.4l65r8M5.js";import"./utils.GoHCELvT.js";var y,B,g,F;class K{constructor(e){U(this,y);U(this,g);k(this,"receiverUser",null);k(this,"senderUser",null);k(this,"messages",[]);console.log(e),this.receiverUser=w(this,y,B).call(this,e==null?void 0:e.receiver_user)??null,this.senderUser=w(this,y,B).call(this,e==null?void 0:e.sender_user)??null,this.messages=w(this,g,F).call(this,e==null?void 0:e.messages)??[]}}y=new WeakSet,B=function(e){return{id:(e==null?void 0:e.id)??null,name:(e==null?void 0:e.name)??"",avatar:(e==null?void 0:e.avatar)??null}},g=new WeakSet,F=function(e){return e.map(s=>({id:s.id,senderId:(s==null?void 0:s.sender_id)??null,receiverId:(s==null?void 0:s.receiver_id)??null,content:(s==null?void 0:s.content)??null,createdAt:(s==null?void 0:s.created_at)??null,updatedAt:(s==null?void 0:s.updated_at)??null}))};const O={class:"h-[250px] relative overflow-hidden rounded-md"},Q={key:1,src:j,class:"w-full h-full object-cover"},W={class:"space-y-1"},X={class:"text-xl md:text-3xl font-medium leading-none"},Z=M({__name:"MessengerHeader",props:{user:{}},setup(t){return console.log(t.user),(s,r)=>(o(),m(l(f),{size:"large"},{default:a(()=>{var p;return[_("div",O,[(o(),d("img",Q))]),_("div",W,[_("h3",X,x((p=s.user)==null?void 0:p.name),1)])]}),_:1}))}}),ee=M({__name:"MessngerForm",emits:["validated","rejected"],setup(t,{emit:e}){const s={textarea:{required:!0,trigger:["blur","input"],message:"Please input textareaValue"}},r=I({textarea:""}),h=I(null),p=e,i=u=>{var v;u.preventDefault(),(v=h.value)==null||v.validate(n=>{n?p("rejected"):p("validated",r.value.textarea)})};return(u,v)=>{const n=H("n-space");return o(),m(l(G),{ref_key:"formRef",ref:h,model:l(r),rules:s},{default:a(()=>[c(l(Y),{span:12,path:"textarea"},{default:a(()=>[c(l(T),{value:l(r).textarea,"onUpdate:value":v[0]||(v[0]=R=>l(r).textarea=R),type:"textarea",autosize:{minRows:3,maxRows:5},placeholder:"Введите ваше сообщение",round:"",clearable:""},null,8,["value"])]),_:1}),c(n,null,{default:a(()=>[c(l(L),{round:"",type:"primary",onClick:i},{default:a(()=>[C(" Отправить ")]),_:1})]),_:1})]),_:1},8,["model"])}}}),se={class:"mt-4"},re=_("div",{class:"text-xl mb-3"},"Сообщение",-1),te={class:"mt-6"},le=_("div",{class:"text-xl mb-3"},"Переписка",-1),oe={class:"chat"},ne={class:"h-[65px] relative overflow-hidden rounded-md"},ae={key:1,src:j,class:"w-full h-full object-cover"},ce={key:1,src:j,class:"w-full h-full object-cover"},ie={key:0},ue={key:1},Ue=M({__name:"[id]",setup(t){const e=S(),s=J();q();const r=I(null),h=async()=>{try{const i=await V.getMessagesById(e.params.id);console.log("Response messenger: ",i),r.value=new K(i.messenger)??null,console.log("mess: ",r.value)}catch(i){console.log(i)}},p=async i=>{try{console.log("data from form: ",i);const u=await V.sendMessageById({receiver_id:e.params.id,content:i??""});s.success(u),await h()}catch(u){console.log("error: to send message: ",u)}};return E(async()=>{await h()}),(i,u)=>(o(),m(l(f),{vertical:""},{default:a(()=>{var v;return[c(Z,{user:(v=r.value)==null?void 0:v.receiverUser},null,8,["user"]),_("div",se,[c(l(f),{vertical:""},{default:a(()=>[re,c(ee,{onValidated:u[0]||(u[0]=n=>p(n))})]),_:1})]),_("div",te,[le,r.value&&r.value.messages.length?(o(),m(l(f),{key:0,vertical:""},{default:a(()=>[(o(!0),d(b,null,P(r.value.messages,(n,R)=>(o(),d("div",oe,[c(l(f),null,{default:a(()=>[c(l(f),null,{default:a(()=>[_("div",ne,[n.senderId===r.value.senderUser.id?(o(),d(b,{key:0},[r.value.senderUser.avatar?(o(),m(l($),{key:0,src:r.value.senderUser.avatar,"fallback-src":"~/assets/images/profile/user-default.png",width:"100%",height:"100%","object-fit":"cover",class:"w-full h-full"},null,8,["src"])):(o(),d("img",ae))],64)):n.senderId===r.value.receiverUser.id?(o(),d(b,{key:1},[r.value.receiverUser.avatar?(o(),m(l($),{key:0,src:r.value.receiverUser.avatar,"fallback-src":"~/assets/images/profile/user-default.png",width:"100%",height:"100%","object-fit":"cover",class:"w-full h-full"},null,8,["src"])):(o(),d("img",ce))],64)):N("",!0)])]),_:2},1024),c(l(f),{vertical:"",justify:"space-between"},{default:a(()=>[c(l(f),{class:"font-medium"},{default:a(()=>[n.senderId===r.value.senderUser.id?(o(),d("div",ie,x(r.value.senderUser.name),1)):n.senderId===r.value.receiverUser.id?(o(),d("div",ue,x(r.value.receiverUser.name),1)):N("",!0),_("div",null,x(n.createdAt),1)]),_:2},1024),C(" "+x(n.content),1)]),_:2},1024)]),_:2},1024)]))),256))]),_:1})):N("",!0)])]}),_:1}))}});export{Ue as default};
